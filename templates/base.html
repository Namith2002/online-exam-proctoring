<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title if title else "Online Exam Proctoring System" }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/exam.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎓</text></svg>">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <a href="{{ url_for('student_dashboard') if session.username and not session.is_admin else url_for('admin_dashboard') if session.is_admin else '/' }}" class="logo">
          🎓 ExamProctor
        </a>
        <nav class="nav">
            {% if session.username %}
              {% if session.is_admin %}
                <a href="{{ url_for('admin_dashboard') }}" class="{{ 'active' if request.endpoint == 'admin_dashboard' else '' }}">📊 Dashboard</a>
                <a href="{{ url_for('create_exam') }}" class="{{ 'active' if request.endpoint == 'create_exam' else '' }}">✏️ Create Exam</a>
              {% else %}
                <a href="{{ url_for('student_dashboard') }}" class="{{ 'active' if request.endpoint == 'student_dashboard' else '' }}">📚 Dashboard</a>
              {% endif %}
              <span class="username">👤 {{ session.username }}</span>
              <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">🌓</button>
              <a href="{{ url_for('logout') }}" class="btn secondary small">🚪 Logout</a>
            {% else %}
              <a href="{{ url_for('login') }}" class="btn primary small">🔑 Login</a>
              <a href="{{ url_for('register') }}" class="btn secondary small">📝 Register</a>
              <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">🌓</button>
              <a href="{{ url_for('admin_login') }}" class="btn outline small">👨‍💼 Admin</a>
            {% endif %}
        </nav>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flashes">
            {% for category, message in messages %}
              <div class="flash {{ category }}">
                {% if category == 'success' %}✅{% elif category == 'error' %}❌{% else %}ℹ️{% endif %}
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <p>&copy; 2025 ExamProctor - Secure Online Exams</p>
      </div>
    </div>
  </footer>

  <script>
    // Auto-hide flash messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      
      // Check for saved theme preference or use the system preference
      const currentTheme = localStorage.getItem('theme') || 
                          (prefersDarkScheme.matches ? 'dark' : 'light');
      
      // Set initial theme
      document.body.setAttribute('data-theme', currentTheme);
      
      // Update theme toggle button
      themeToggle.textContent = currentTheme === 'dark' ? '🌞' : '🌙';
      
      // Toggle theme when button is clicked
      themeToggle.addEventListener('click', function() {
        const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        themeToggle.textContent = newTheme === 'dark' ? '🌞' : '🌙';
      });
      
      // Auto-hide flash messages after 5 seconds
      const flashMessages = document.querySelectorAll('.flash');
      flashMessages.forEach(function(message) {
        setTimeout(function() {
          message.style.opacity = '0';
          setTimeout(function() {
            message.style.display = 'none';
          }, 300);
        }, 5000);
      });
      
      // Add loading state to submit buttons
      const forms = document.querySelectorAll('form');
      forms.forEach(function(form) {
        form.addEventListener('submit', function() {
          const submitBtn = form.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = 'Processing...';
          }
        });
      });
    });
  </script>
  <script src="{{ url_for('static', filename='js/ui.js') }}" defer></script>
  
  {% block scripts %}{% endblock %}
</body>
</html>
